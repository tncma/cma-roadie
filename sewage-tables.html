<!DOCTYPE html>
<html lang="en"><head>
    <meta charset="utf-8">
    <title>CMA Roadie</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="">
    <meta name="author" content="">

    <!-- Le styles -->
    <link href="css/style.css" rel="stylesheet">
    <link href="css/bootstrap.css" rel="stylesheet">

    
    <link rel="stylesheet" href="css/jquery-ui-1.8.16.custom.css" media="screen"  />
    <link rel="stylesheet" href="css/fullcalendar.css" media="screen"  />
    <link rel="stylesheet" href="css/chosen.css" media="screen"  />
    <link rel="stylesheet" href="css/glisse.css?1.css">
    <link rel="stylesheet" href="css/jquery.jgrowl.css">
    <link rel="stylesheet" href="css/demo_table.css" >
    <link rel="stylesheet" href="css/jquery.fancybox.css?v=2.1.4" media="screen" />
    
	<link rel="stylesheet" href="css/icon/font-awesome.css">    
    <link rel="stylesheet" href="css/bootstrap-responsive.css">
    
    <link rel="alternate stylesheet" type="text/css" media="screen" title="green-theme" href="css/color/green.css" />
	<link rel="alternate stylesheet" type="text/css" media="screen" title="red-theme" href="css/color/red.css" />
	<link rel="alternate stylesheet" type="text/css" media="screen" title="blue-theme" href="css/color/blue.css" />
    <link rel="alternate stylesheet" type="text/css" media="screen" title="orange-theme" href="css/color/orange.css" />
    <link rel="alternate stylesheet" type="text/css" media="screen" title="purple-theme" href="css/color/purple.css" />

    <!-- Le HTML5 shim, for IE6-8 support of HTML5 elements -->
    <!--[if lt IE 9]>
      <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
     <script language="JavaScript">
	Firefox = navigator.userAgent.indexOf("Firefox") >= 0;
	if(Firefox) document.write("<link rel='stylesheet' href='css/moz.css' type='text/css'>"); 
	</script>
    
    <!-- Le fav and touch icons -->
    <link rel="shortcut icon" href="favicon.ico">
    
    <style>
		#Very-severe{
			color:#F80000;
		}
		#Severe{
			color:#FFA93C;
		}
		#Ordinary{
			color:#000099;
		}
		#No-Image{
			text-decoration:none;
			color:#000;
		}
	</style>
  </head>

  <body>
    <!--BEGIN HEADER-->
    <div id="header" role="banner">
       <a id="menu-link" class="head-button-link menu-hide" href="#menu"><span>Menu</span></a>
       <!--Logo--><a href="dashboard.html" class="logo"><h1>CMA Roadie</h1></a><!--Logo END-->
       
       <!--Search-->
       <form class="search" action="#">
         <input type="text" name="q" placeholder="Search...">
       </form>
       <!--Search END-->
       
       <div class="right">
       
       <!--message box-->
         <div class="dropdown left">
          
          <a class="dropdown-toggle head-button-link" data-toggle="dropdown" href="#"><span class="notice-new">3</span></a> 
          
          <div class="dropdown-menu pull-right messages-list">
          <div class="triangle"></div>
          
            <div class="notice-title">You Have 3 Massages</div>
            <!--message #1-->
            <div class="notice-message">
            <a href="#" class="box">
              <div class="avatar"><img src="images/avatar-2.png" alt=""></div>
              <div class="info">
                <div class="author">Csaba Gyulai</div>
                <div class="date">Jan 9, 2013</div>
                <div class="clearfix"></div>
                <div class="text">This is Photoshop's version  of Lorem Ipsum. Proin gravida nibh vel velit.</div>
              </div>
              <div class="clearfix"></div>
            </a>
            </div>
            <!--message #2-->
            <div class="notice-message">
            <a href="#" class="box">
              <div class="avatar"><img src="images/avatar-3.png" alt=""></div>
              <div class="info">
                <div class="author">Junkyard Sam</div>
                <div class="date">Jan 15, 2013</div>
                <div class="clearfix"></div>
                <div class="text">This is Photoshop's version  of Lorem Ipsum. Proin gravida nibh vel velit.</div>
              </div>
              <div class="clearfix"></div>
            </a>
            </div>
            <!--message #3-->
            <div class="notice-message">
            <a href="#" class="box">
              <div class="avatar"><img src="images/avatar-4.png" alt=""></div>
              <div class="info">
                <div class="author">Lienke Raben</div>
                <div class="date">Nov 4, 2012</div>
                <div class="clearfix"></div>
                <div class="text">This is Photoshop's version  of Lorem Ipsum. Proin gravida nibh vel velit.</div>
              </div>
              <div class="clearfix"></div>
            </a>
            </div>
           
            <a href="#" class="notice-more">View All Messages</a>
          </div>
        </div>
       <!--message box end-->
       
       <!--notification box-->
         <div class="dropdown left">
          <a class="dropdown-toggle head-button-link notification" data-toggle="dropdown" href="#"><span class="notice-new">2</span></a>
          
          <div class="dropdown-menu pull-right messages-list">
          <div class="triangle"></div>
          
            <div class="notice-title">You Have 2 Notifications</div>
            <!--message #1-->
            <div class="notice-message">
            <a href="#" class="box">
              <div class="avatar"><img src="images/avatar-5.png" alt=""></div>
              <div class="info">
                <div class="author">Jonas Anderson</div>
                <div class="date">3 hours ago</div>
                <div class="clearfix"></div>
                <div class="text">Followed <span class="follow-link">Dennis Salvatier</span></div>
              </div>
              <div class="clearfix"></div>
            </a>
            </div>
            <!--message #2-->
            <div class="notice-message">
            <a href="#" class="box">
              <div class="avatar"><img src="images/avatar-6.png" alt=""></div>
              <div class="info">
                <div class="author">Ilias Sounas</div>
                <div class="date">19 hours ago</div>
                <div class="clearfix"></div>
                <div class="text">Commented on <span class="comment-link">Angry Cloud</span></div>
              </div>
              <div class="clearfix"></div>
            </a>
            </div>
            <!--message #3-->
            <div class="notice-message">
            <a href="#" class="box">
              <div class="avatar"><img src="images/avatar-7.png" alt=""></div>
              <div class="info">
                <div class="author">Erin Hunting</div>
                <div class="date">19 hours ago</div>
                <div class="clearfix"></div>
                <div class="text">Liked <span class="like-link">Overnight work</span></div>
              </div>
              <div class="clearfix"></div>
            </a>
            </div>
           
            <a href="#" class="notice-more">View All Notification</a>
          </div>
        </div>
       <!--notification box end-->
       
       <!--config box-->
         <div class="dropdown left">
          <a class="dropdown-toggle head-button-link config" data-toggle="dropdown" href="#"></a>
          <div class="dropdown-menu pull-right settings-box">
          <div class="triangle-2"></div>
          
            <a href="javascript:chooseStyle('none', 30)" class="settings-link"></a>
            <a href="javascript:chooseStyle('blue-theme', 30)" class="settings-link blue"></a>
            <a href="javascript:chooseStyle('green-theme', 30)" class="settings-link green"></a>
            <a href="javascript:chooseStyle('purple-theme', 30)" class="settings-link purple"></a>
            <a href="javascript:chooseStyle('orange-theme', 30)" class="settings-link yellow"></a>
            <a href="javascript:chooseStyle('red-theme', 30)" class="settings-link red"></a>
            <div class="clearfix"></div>
          </div>
        </div>

       <!--config box end-->
       
       <!--profile box-->
         <div class="dropdown left profile">
          <a class="dropdown-toggle" data-toggle="dropdown" href="#">
            <span class="double-spacer"></span>
            <div class="profile-avatar"><img src="images/avatar.png" alt=""></div>
            <div class="profile-username"><span>Welcome,</span> Admin!</div>
            <div class="profile-caret"> <span class="caret"></span></div>
            <span class="double-spacer"></span>
          </a>
          <div class="dropdown-menu pull-right profile-box">
          <div class="triangle-3"></div>
          
            <ul class="profile-navigation">
              <li><a href="#"><i class="icon-user"></i> My Profile</a></li>
              <li><a href="#"><i class="icon-cog"></i> Settings</a></li>
              <li><a href="#"><i class="icon-info-sign"></i> Help</a></li>
              <li><a href="index.html"><i class="icon-off"></i> Logout</a></li>
            </ul>
          </div>
        </div>
        <div class="clearfix"></div>
       <!--profile box end-->
       
       </div>
       
      
    </div>
    <!--END HEADER-->
   
    <div id="wrap">
    
    
    	<!--BEGIN SIDEBAR-->
        <div id="menu" role="navigation">
        
          <ul class="main-menu">
             <li><a href="dashboard.html"><i class="general"></i> General</a></li>
             <li><a href="road-tables.html"><i class="components"></i> Roads</a></li>
             <li><a href="light-tables.html"><i class="forms"></i> Light</a></li>
             <li class="active"><a href="sewage-tables.html"><i class="statistics"></i> Sewage</a></li>
          </ul>
          
       
          
        </div>
        <!--SIDEBAR END-->
    
    	
        <!--BEGIN MAIN CONTENT-->
        <div id="main" role="main">
          <div class="block">
   		  <div class="clearfix"></div>
            
             <!--page title-->
             <div class="pagetitle">
                <h1>Sewage complaints</h1> 
                <div class="btn-group">
                  <button onClick="filterFunctionFixed()" class="s_green">Fixed</button>
                  <button onClick="filterFunctionNotFixed()" class="s_orange">Not Fixed</button>
                  <button onClick="filterFunctionSuspended()" class="s_gray">Suspended</button>
                </div>
                <div class="clearfix"></div>
             </div>
             <!--page title end-->
             
             
              
              <!--Example Table-->
              <div class="grid">
              
              <div class="grid-title">
               <div class="pull-left">
                  <div class="icon-title"><i class="icon-eye-open"></i></div>
                  <span>Complaints list</span> 
                  <div class="clearfix"></div>
               </div>
               <div class="pull-right"> 
               	  <div class="icon-title"><a href="#"><i class="icon-refresh"></i></a></div>
                  <div class="icon-title"><a href="#"><i class="icon-cog"></i></a></div>
               </div>
              <div class="clearfix"></div>   
              </div>
            
              <div class="grid-content overflow">
                
                    <table class="table table-bordered table-mod-2" id="datatable_3">
                        <thead>
                          <tr>
                            <th class="hidden-mobile">Phone No.</th>
                            <th class="hidden-mobile">Email</th>
                            <th class="hidden-mobile">Street name</th>
                            <th class="hidden-mobile">Date</th>
                            <th class="hidden-mobile">Image</th>
                            <th class="hidden-mobile" >Status</th>
                            <th style="visibility:{collapse}">Actions</th>
                          </tr>
                        </thead>
                        <tbody id="road-table-row">
                           <script>
								
								var collapse = 'visible';
								function retreiveRoadList(status){
									
									var xhr = new XMLHttpRequest();
									
									xhr.onreadystatechange = function() {
										 if (xhr.readyState == 4) {
											 var text = xhr.responseText;
											 text = JSON.parse(text);
											 text = text.result;
											 for(index in text){
												 var status = 'Ordinary';
												 if(text[index].count > 7) status = 'Very-severe' 
												 else if(text[index].count > 3) status = 'Severe';
												 var classOddEven = 'odd';
												 if(index.length%2 == 0)   classOddEven = 'even' 
												 else classOddEven = 'odd';
												 var imgStat = 'No-Image'
												 if(text[index].img == 1) imgStat = 'Click here';
  											     
												 if (text[index].status == 2) collapse = 'collapse'
													else if (text[index].status == 3) collapse = 'collapse'
											 $('body').find('#road-table-row').append('<tr class="'+classOddEven+'"><td class="hidden-mobile">'+text[index].phone+'</td><td class="hidden-mobile">'+text[index].emailid+'</td><td class="hidden-mobile">'+text[index].street+'</td><td class="hidden-mobile">'+text[index].created+'</td><td><a class="thumbnail fancybox" data-fancybox-group="gallery" href="http://107.22.214.135:3001/download/'+text[index].content+'.png"><span class="action-table" onClick="clickImg('+text[index].id+')" id="'+imgStat+'">'+imgStat+'</span></a></td><td class="action-table" id="'+status+'">'+status+'</td><td style="visibility:'+collapse+'"> <button id="fixedButton" onClick="fixedStatus('+text[index].id+')" class="s_green">Fixed</button><button onClick="suspendedStatus('+text[index].id+')" class="s_gray">Suspended</button></td></tr>');
											 }	
										}
									}	
									xhr.open('GET', 'http://107.22.214.135:3001/list/sewage/'+status+'', true);
									
									xhr.send(null);									
								}								
		  
								function clickImg(id){
									var xhr = new XMLHttpRequest();
									xhr.onreadystatechange = function() {
										 if (xhr.readyState == 4) {
											
											var text = xhr.responseText;
											text = JSON.parse(text);
													 text = text.result;
													  for(index in text){
														  
														   alert((text[index].content));
														   
															
													  }
										 }
									}
											
									//xhr.open('GET', 'http://107.22.214.135:3001/image/'+id+'', true);
									//xhr.send(null);
																			
								}
							
								window.onload = function()
								{
								   retreiveRoadList(1);
								};
								
								function filterFunctionFixed(){
									clearTable();
									retreiveRoadList(3);
								}
								function filterFunctionNotFixed(){
									clearTable();
									retreiveRoadList(1);

								}
								function filterFunctionSuspended(){
									clearTable();
									retreiveRoadList(2);
								}
								
								function clearTable()
								{
								 var tableRef = document.getElementById('road-table-row');
								 while ( tableRef.rows.length > 0 )
								 {
								  tableRef.deleteRow(0);
								 }
								}
								
								function fixedStatus(id){
										var xhrTwo = new XMLHttpRequest();
										xhrTwo.open("GET", 'http://107.22.214.135:3001/status/'+id+'/3', false);
										xhrTwo.send(null);
										
										window.location.href = "road-tables.html"
										return xhrTwo.responsiveText;																											
								}
								
								function suspendedStatus(id){
										var xhrTwo = new XMLHttpRequest();
										xhrTwo.open("GET", 'http://107.22.214.135:3001/status/'+id+'/2', false);
										xhrTwo.send(null);
										
										window.location.href = "road-tables.html"
										return xhrTwo.responsiveText;																											
								}
								
							</script>
                            
                        </tbody>
                   </table>  
				
                
                  <div class="clearfix"></div>
                  </div>
              
              </div>
              <!--Example Table END-->
              
              
              
              
               
               <!--BEGIN FOOTER-->
               <div class="footer">
                  <div class="left">Copyright &copy; 2013</div>
                  <div class="right"><a href="http://www.thoughtworks.com/events/cma-hackathon-code-governance">Hackathon - CMA Roadie</a></div>
                  <div class="clearfix"></div>
               </div>
               <!--BEGIN FOOTER END-->
              
          <div class="clearfix"></div> 
          </div><!--end .block-->
        </div>
        <!--MAIN CONTENT END-->
    
    </div>
    <!--/#wrapper-->


    <!-- Le javascript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script src="js/jquery.min.js"></script>
    <script src="js/jquery-ui.min.js"></script>
   
    <script src="js/bootstrap.min.js"></script>
    <script src="js/google-code-prettify/prettify.js"></script>
   
    <script src="js/jquery.flot.js"></script>
    <script src="js/jquery.flot.pie.js"></script>
    <script src="js/jquery.flot.orderBars.js"></script>
    <script src="js/jquery.flot.resize.js"></script>
    <script src="js/jquery.flot.categories.js"></script>
    <script src="js/graphtable.js"></script>
    <script src="js/fullcalendar.min.js"></script>
    <script src="js/chosen.jquery.min.js"></script>
    <script src="js/autoresize.jquery.min.js"></script>
    <script src="js/jquery.autotab.js"></script>
    <script src="js/jquery.jgrowl_minimized.js"></script>
    <script src="js/jquery.dataTables.min.js"></script>
    <script src="js/jquery.stepy.min.js"></script>
    <script src="js/jquery.validate.min.js"></script>
    <script src="js/raphael.2.1.0.min.js"></script>
    <script src="js/justgage.1.0.1.min.js"></script>
	<script src="js/glisse.js"></script>
	<script src="js/styleswitcher.js"></script>
	<script src="js/moderniz.js"></script>
    <script src="js/jquery.sparkline.min.js"></script>
    <script src="js/slidernav-min.js"></script>
    <script type="text/javascript" src="js/jquery.fancybox.js?v=2.1.4"></script>
    
	<script>
    Modernizr.load([
        {
         load: [
                'js/main.js'
            ],
            complete: function()
            {
                $.fn.ready(function()
                {
                    window.App.init();
                });
            }
        }
    ]);
    </script>
	<script src="js/application.js"></script>


  </body>
</html>

